java内存数据分为五大区域：

<img src="/Users/nate/Library/Application Support/typora-user-images/image-20191107194947089.png" alt="image-20191107194947089" style="zoom:50%;" />





## 1. 程序计数器

程序计数器是一块很小的内存空间，它是线程私有的，可以认作为当前线程的行号指示器。

**为什么需要程序计数器**

我们知道对于一个处理器(如果是多核cpu那就是一核)，在一个确定的时刻都只会执行一条线程中的指令，一条线程中有多个指令，为了线程切换可以恢复到正确执行位置，每个线程都需有独立的一个程序计数器，不同线程之间的程序计数器互不影响，独立存储。

注意：如果线程执行的是个java方法，那么计数器记录虚拟机字节码指令的地址。如果为native【底层方法】，那么计数器为空。**这块内存区域是虚拟机规范中唯一没有OutOfMemoryError的区域**。



## 2.栈

**栈描述的是Java方法执行的内存模型**。

### 2.1 栈的特点

每当启动一个新线程时，Java虚拟机都会为它分配一个Java栈。虚拟机只会直接对Java栈执行两种操作，以帧为单位的压栈和出栈。

- **栈存储的是什么**

  方法内的局部变量表、操作数栈、动态链接、方法出口信息、其他等信息.

- **栈的生命周期**

  是在线程创建时创建，线程结束而消亡，释放内存，由此可见栈内存是私有的。
  栈内存是以栈帧(Stack Frame)为单位存储，栈帧是一个内存区块，是一个有关方法(Method)和运行期数据的数据集。
  当一个方法M1被调用时就产生了一个栈帧S1，并被压入到栈中，M1方法又调用了M2方法，于是产生栈帧S2也被压入栈，M2方法执行完毕后，S2栈帧先出栈，S1栈帧再出栈，遵循“先进后出”原则。

### 2.2 栈帧

<img src="/Users/nate/Library/Application Support/typora-user-images/image-20191107202208801.png" alt="image-20191107202208801" style="zoom:50%;" />

栈帧存储数据包含一下5个部分：

- 局部变量表

  保存函数的参数以及局部变量用的，局部变量表中的变量只在当前函数调用中有效，当函数调用结束后，随着函数栈帧的销毁，局部变量表也会随之销毁。

  存放基本数据类型变量(boolean、byte、char、short、int、float)、引用类型的变量(reference)、returnAddress(指向一条字节码指令的地址)类型的变量。

- 操作数栈

  主要用于保存计算过程的中间结果，同时作为计算过程中变量临时的存储空间。

- 动态链接

  每个栈帧都包含一个指向运行时常量池中该栈帧所属性方法的引用，持有这个引用是为了支持方法调用过程中的动态连接。

- 方法出口信息

  一般来说，方法正常退出时，调用者PC计数器的值就可以作为返回地址，栈帧中很可能会保存这个计数器值。而方法异常退出时，返回地址是 要通过异常处理器来确定的，栈帧中一般不会保存这部分信息。

**需要注意的是，局部变量表所需要的内存空间在编译期完成分配，当进入一个方法时，这个方法在栈中需要分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表大小**



Java虚拟机栈可能出现两种类型的异常：

- 线程请求的栈深度大于虚拟机配置(-xss)的栈深度，将抛出StackOverflowError。

- 虚拟机栈空间可以动态扩展，当动态扩展是无法申请到足够的空间时，抛出OutOfMemory异常。

### 2.3 本地方法栈

本地方法栈是与虚拟机栈发挥的作用十分相似,区别是虚拟机栈执行的是Java方法(也就是字节码)服务，而本地方法栈则为虚拟机使用到的native方法服务，可能底层调用的c或者c++,我们打开jdk安装目录可以看到也有很多用c编写的文件，可能就是native方法所调用的c代码。

### 2.4 堆

所有对象实例及数组都要在堆上分配内存

在 Java 中，堆被划分成两个不同的区域：新生代 ( Young )、老年代 ( Old )。新生代 ( Young ) 又被划分为三个区域：Eden、From Survivor、To Survivor。

这样划分的目的是为了使 JVM 能够更好的管理堆内存中的对象，包括内存的分配以及回收。
堆的内存模型大致为：

<img src="/Users/nate/Library/Application Support/typora-user-images/image-20191107204416403.png" alt="image-20191107204416403" style="zoom:50%;" />

堆的大小可以通过参数 –Xms、-Xmx 来指定

### 2.5 方法区

用于存储已被虚拟机加载的类信息、常量、静态变量。

1.8以后叫元空间



